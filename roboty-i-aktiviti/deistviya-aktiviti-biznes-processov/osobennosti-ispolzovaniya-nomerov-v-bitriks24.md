# Особенности использования номеров в активити бизнес-процессов

Практически в каждом активити вам предстоит использовать номер телефона. Давайте разберёмся, как это делать правильно.

В карточке CRM (лид, контакт, компания) есть возможность использовать как один, так и несколько номеров телефонов, причём с разными типами (мобильный, рабочий, для рассылок, другой, и т.д.).

Если номер один, то вопросов обычно не возникает. Проблемы появляются, когда номеров несколько. В этом случае важно учитывать на какой и на сколько номеров вы отправляете сообщение.

Когда вы передаёте номер (номера) телефонов в активити, то они могут передаваться как массив номеров **{=Document:PHONE}** или как текстовая строка **{=Document:PHONE\_PRINTABLE}.**

{% hint style="warning" %}
Обратите внимание, что **{=Document:PHONE}** собирает и передаёт номера ВСЕХ типов. **Если в активити передан подобный массив номеров и их там несколько – отправка будет осуществлена на первый номер в списке, на котором есть WhatsApp!**
{% endhint %}

Для того, чтобы исключить ошибки, можно воспользоваться одним из способов, описанных ниже.

### **Используйте отдельный тип телефона для отправки сообщений в WhatsApp**

Например, «Для рассылок» {=Document:PHONE\_MAILING}. Этот тип телефона можно использовать не только в бизнес-процессах но и в рассылках.

<figure><img src="../../.gitbook/assets/image (741).png" alt=""><figcaption></figcaption></figure>

### **Используйте** [**функцию firstvalue**](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE\_ID=57\&LESSON\_ID=4912) для указания первого значения из массива

В этом случае из массива номеров {=Document:PHONE} будет выбран и подставлен в активити первый по счёту номер.

Для вызова окна функций введите в поле для ввода номера телефона знак «равно» и в открывшемся окне выберите функцию **firstvalue.**

<figure><img src="../../.gitbook/assets/image (571).png" alt=""><figcaption></figcaption></figure>

В круглых скобках функции укажите массив номеров, из которых нужно выбрать первое значение. Например, **\{{Контакт: Телефон\}}.**

<figure><img src="../../.gitbook/assets/image (24).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Обратите внимание, что при использовании функции **firstvalue** переменную **\{{Телефон\}} / \{{Контакт: Телефон\}} / \{{Компания: Телефон\}}** нужно передавать без модификатора «(текст)» или «\_PRINTABLE», т.к. важно передавать именно массив номеров.
{% endhint %}

### **Используйте активити** [**Итератор**](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE\_ID=57\&LESSON\_ID=10481)**,** чтобы перебрать номера в массиве и задать свою логику для каждого из номеров массива

Создайте переменную бизнес-процесса

![](<../../.gitbook/assets/image (816).png>)

Добавьте активити «Изменение переменных» и «Итератор»

Установите переменную для этих активити

![](<../../.gitbook/assets/image (520).png>)

![](<../../.gitbook/assets/image (904).png>)

Внутри итератора будут перебираться номера телефонов и вы сможете выполнять проверки и производить действия с каждым номером.

{% hint style="info" %}
Помните, что во всех вышеописанных способах вам необходимо учитывать ещё одно обстоятельство, а именно – наличие WhatsApp на номере, на который делается отправка.

В настоящее время проверка номера на наличие WhatsApp осуществляется сразу при отправке сообщения. Если отправка осуществляется на номер, на котором не установлен WhatsApp, в дополнительных результатах выполнения активити вы получите ошибку **«NW»** а в описании ошибки — более развёрнутое её описание: **«Ошибка при отправке: телефонный номер 7961\*\*\*\*\*57 не найден в WhatsApp»**
{% endhint %}

<figure><img src="../../.gitbook/assets/image (509).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Если вы хотите явно получить результат проверки номера на наличие WhatsApp и использовать его в ваших сценариях работы, проверку номера из массива номеров на наличие WhatsApp можно также осуществлять с помощью итератора. Подробнее в статье [Проверка номера](proverka-nomera.md).
{% endhint %}
