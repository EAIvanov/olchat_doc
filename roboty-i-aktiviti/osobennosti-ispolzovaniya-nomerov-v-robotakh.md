# Особенности использования номеров в роботах

Практически в каждом роботе вам предстоит использовать номер телефона. Давайте разберёмся, как это делать правильно.

В карточке CRM (лид, контакт, компания) есть возможность использовать как один, так и несколько номеров телефонов, причём с разными типами (мобильный, рабочий, для рассылок, другой, и т.д.).

Если номер один, то вопросов обычно не возникает. Проблемы появляются, когда номеров несколько. В этом случае важно учитывать на какой и на сколько номеров вы отправляете сообщение.

Когда вы передаёте номер (номера) телефонов в робот, то они могут передаваться как массив номеров – **\{{Телефон\}}** (также **\{{Контакт: Телефон\}}** и **\{{Компания: Телефон\}}**) или как текстовая строка – **\{{Телефон (текст)\}}** (также **\{{Контакт: Телефон (текст)\}}** и **\{{Компания: Телефон (текст)\}}**).

{% hint style="warning" %}
Обратите внимание, что переменная **\{{Телефон\}} / \{{Контакт: Телефон\}} / \{{Компания: Телефон\}}** или **\{{Телефон (текст)\}} / \{{Контакт: Телефон (текст)\}} / \{{Компания: Телефон (текст)\}}** собирает и передаёт номера ВСЕХ типов.

**Если в робот передан подобный массив номеров или текстовая строка с номерами и их там несколько – отправка будет осуществлена на первый номер в списке, на котором есть WhatsApp!**
{% endhint %}

Для того, чтобы исключить ошибки, можно воспользоваться одним из способов, описанных ниже:

### **Используйте отдельный тип телефона для отправки сообщений в WhatsApp**

Например, «Для рассылок». Возможные варианты, которые могут принимать переменные:

* \{{Телефон для рассылок\}}
* \{{Контакт: Телефон для рассылок\}}
* \{{Компания: Телефон для рассылок\}}
* \{{Телефон для рассылок (текст)\}}
* \{{Контакт: Телефон для рассылок (текст)\}}
* \{{Компания: Телефон для рассылок (текст)\}}

При настройке робота используйте один из вариантов переменной, подставляя её в поле **Номер телефона (кому отправляем)**

<figure><img src="../../.gitbook/assets/image (905).png" alt=""><figcaption></figcaption></figure>

### **Используйте** [**функцию firstvalue**](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE\_ID=57\&LESSON\_ID=4912) для указания первого значения из массива номеров.

При использовании функции **firstvalue** из массива номеров **\{{Телефон\}} / \{{Контакт: Телефон\}} / \{{Компания: Телефон\}}** будет выбран и подставлен в робот первый по счёту номер.

При настройке робота используйте один из возможных вариантов конструкций, подставляя её в поле **Номер телефона (кому отправляем):**

* \{{=firstvalue(\{{Телефон\}})\}}
* \{{=firstvalue(\{{Контакт: Телефон\}})\}}
* \{{=firstvalue(\{{Компания: Телефон\}})\}}

{% hint style="warning" %}
Обратите внимание, что при использовании функции **firstvalue** переменную **\{{Телефон\}} / \{{Контакт: Телефон\}} / \{{Компания: Телефон\}}** нужно передавать без модификатора «(текст)», т.к. важно передавать именно массив номеров.
{% endhint %}

<figure><img src="../../.gitbook/assets/image (251).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Если на вашем тарифе Битрикс24 доступен дизайнер Бизнес-процессов, вы можете воспользоваться ещё одним способом - перебором телефонов в Итераторе. Подробнее в статье [Особенности использования номеров в бизнес-процессах](https://docs.olchat.io/roboty-i-aktiviti/deistviya-aktiviti-biznes-processov/osobennosti-ispolzovaniya-nomerov-v-bitriks24#3.-ispolzuite-aktiviti-iterator-chtoby-perebrat-nomera-v-massive-i-zadat-svoyu-logiku-dlya-kazhdogo)
{% endhint %}
